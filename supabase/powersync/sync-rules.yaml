config:
  edition: 2

streams:
  orgs/{org_id}/repos/{repo_id}/refs:
    auto_subscribe: false
    query: |
      SELECT id, org_id, repo_id, name, target_sha, updated_at
      FROM refs
      WHERE subscription.parameter('org_id') IS NOT NULL
        AND subscription.parameter('repo_id') IS NOT NULL
        AND org_id = subscription.parameter('org_id')
        AND repo_id = subscription.parameter('repo_id')

  orgs/{org_id}/repos/{repo_id}/commits:
    auto_subscribe: false
    query: |
      SELECT id, org_id, repo_id, sha, author_name, author_email, authored_at, message, tree_sha
      FROM commits
      WHERE subscription.parameter('org_id') IS NOT NULL
        AND subscription.parameter('repo_id') IS NOT NULL
        AND org_id = subscription.parameter('org_id')
        AND repo_id = subscription.parameter('repo_id')

  orgs/{org_id}/repos/{repo_id}/file_changes:
    auto_subscribe: false
    query: |
      SELECT id, org_id, repo_id, commit_sha, path, additions, deletions
      FROM file_changes
      WHERE subscription.parameter('org_id') IS NOT NULL
        AND subscription.parameter('repo_id') IS NOT NULL
        AND org_id = subscription.parameter('org_id')
        AND repo_id = subscription.parameter('repo_id')

  orgs/{org_id}/repos/{repo_id}/objects:
    auto_subscribe: false
    query: |
      SELECT id, org_id, repo_id, pack_oid, storage_key, size_bytes, created_at
      FROM objects
      WHERE subscription.parameter('org_id') IS NOT NULL
        AND subscription.parameter('repo_id') IS NOT NULL
        AND org_id = subscription.parameter('org_id')
        AND repo_id = subscription.parameter('repo_id')
